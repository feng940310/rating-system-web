(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-works-works"],{"0a8b":function(e,t,r){"use strict";var a=r("7992"),n=TypeError,o=function(e){var t,r;this.promise=new e((function(e,a){if(void 0!==t||void 0!==r)throw new n("Bad Promise constructor");t=e,r=a})),this.resolve=a(t),this.reject=a(r)};e.exports.f=function(e){return new o(e)}},"0f1f":function(e,t,r){"use strict";(function(e,a){r("6a54");var n=r("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("3471")),i=n(r("b7c7")),s=n(r("9b1b")),c=n(r("2634")),l=n(r("2fdc"));r("bf0f"),r("f3f7"),r("18f7"),r("de6c"),r("8f71"),r("7a76"),r("c9b5"),r("fd3c"),r("2797"),r("aa9c"),r("dc8a"),r("f7a5"),r("01a2"),r("e39c"),r("ab80"),r("aa77"),r("0c26"),r("5c47"),r("a1c1"),r("2c10"),r("c223"),r("fb2c"),r("3e37"),r("bd06"),r("22b6"),r("08eb"),r("4100"),r("0506"),r("e966");var u={data:function(){return{currentFilter:"all",allWorks:[],loading:!0,userInfo:null,confirmedImages:{},imageTryIndex:{},workImageFiles:{},intersectionObserver:null,visibleWorkIds:new Set,loadingCoverIds:new Set,loadedCoverIds:new Set,coverLoadQueue:[]}},onLoad:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.userInfo=uni.getStorageSync("userInfo"),t.userInfo&&t.userInfo._id){r.next=5;break}return e.error("用户信息不完整，跳转到登录页"),uni.redirectTo({url:"/pages/login/login"}),r.abrupt("return");case 5:return r.next=7,t.loadWorksOnly();case 7:case"end":return r.stop()}}),r)})))()},onUnload:function(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.visibleWorkIds.clear(),this.loadingCoverIds.clear(),this.loadedCoverIds.clear()},onShow:function(){},computed:{pendingWorks:function(){var e=this;return this.allWorks.filter((function(t){return!e.isWorkRatedByUser(t)}))},ratedWorks:function(){var e=this;return this.allWorks.filter((function(t){return e.isWorkRatedByUser(t)}))},filteredWorks:function(){switch(this.currentFilter){case"pending":return this.pendingWorks;case"rated":return this.ratedWorks;default:return this.allWorks}}},methods:{loadWorksOnly:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o,i,l,u;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,t.loading=!0,t.userInfo&&t.userInfo._id){r.next=6;break}return e.error("用户信息不完整，无法加载作品"),uni.showToast({title:"用户信息异常，请重新登录",icon:"error"}),r.abrupt("return");case 6:return r.next=8,a.callFunction({name:"getWorks",data:{userId:t.userInfo._id},spaceType:"aliyun"});case 8:if(n=r.sent,!(n.result&&n.result.success&&n.result.data)){r.next=21;break}if(o=n.result.data.works||n.result.data,Array.isArray(o)){r.next=14;break}throw e.error("作品数据不是数组格式:",o),new Error("作品数据格式错误");case 14:i=o.map((function(e){return(0,s.default)((0,s.default)({},e),{},{userHasRated:e.userHasRated||!1,userScore:e.userScore,userTotalScore:e.userTotalScore})})),t.allWorks=i,t.$forceUpdate(),t.cacheWorksData(i),t.$nextTick((function(){t.initLazyCoverLoading()})),r.next=24;break;case 21:e.error("获取作品失败:",null===(l=n.result)||void 0===l?void 0:l.message),uni.showToast({title:(null===(u=n.result)||void 0===u?void 0:u.message)||"获取作品失败",icon:"error"}),t.allWorks=[];case 24:r.next=31;break;case 26:r.prev=26,r.t0=r["catch"](0),e.error("加载作品列表失败:",r.t0),uni.showToast({title:"网络异常，请稍后重试",icon:"error"}),t.allWorks=[];case 31:return r.prev=31,t.loading=!1,r.finish(31);case 34:case"end":return r.stop()}}),r,null,[[0,26,31,34]])})))()},initLazyCoverLoading:function(){var e=this;this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=new IntersectionObserver((function(t){e.handleIntersection(t)}),{root:null,rootMargin:"200px",threshold:.1}),this.$nextTick((function(){e.observeWorkCards()}))},observeWorkCards:function(){var e=this,t=document.querySelectorAll(".work-card");t.forEach((function(t){e.intersectionObserver&&e.intersectionObserver.observe(t)}))},handleIntersection:function(e){var t=this,r=[];e.forEach((function(e){var a=e.target.getAttribute("data-work-id");a&&(e.isIntersecting?t.visibleWorkIds.has(a)||(t.visibleWorkIds.add(a),r.push(a)):t.visibleWorkIds.has(a)&&t.visibleWorkIds.delete(a))})),r.length>0&&this.loadVisibleCovers(r)},loadVisibleCovers:function(t){var r=this;return(0,l.default)((0,c.default)().mark((function n(){var o,i;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t&&0!==t.length){n.next=2;break}return n.abrupt("return");case 2:if(o=t.filter((function(e){return!r.loadedCoverIds.has(e)&&!r.loadingCoverIds.has(e)})),0!==o.length){n.next=5;break}return n.abrupt("return");case 5:return o.forEach((function(e){return r.loadingCoverIds.add(e)})),n.prev=6,n.next=9,a.callFunction({name:"getWorkFiles",data:{workIds:o},spaceType:"aliyun"});case 9:i=n.sent,i.result&&i.result.success&&i.result.data&&(Object.keys(i.result.data).forEach((function(e){var t=i.result.data[e];t&&(r.processCoverFiles(e,t),r.loadedCoverIds.add(e)),r.loadingCoverIds.delete(e)})),r.$forceUpdate()),n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](6),e.error("加载可见封面失败:",n.t0),o.forEach((function(e){return r.loadingCoverIds.delete(e)}));case 17:case"end":return n.stop()}}),n,null,[[6,13]])})))()},processCoverFiles:function(e,t){var r=[];t.cover&&r.push(t.cover),t.images&&Array.isArray(t.images)&&r.push.apply(r,(0,i.default)(t.images.filter((function(e){return e&&"string"===typeof e})))),t.thumbnails&&Array.isArray(t.thumbnails)&&r.push.apply(r,(0,i.default)(t.thumbnails.filter((function(e){return e&&"string"===typeof e})))),this.workImageFiles||(this.workImageFiles={}),this.workImageFiles[e]=r,this.imageTryIndex[e]=0},loadCoversAsync:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o,s,l;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,t.allWorks&&0!==t.allWorks.length){r.next=3;break}return r.abrupt("return");case 3:n=5,o=t.allWorks.map((function(e){return e.id})),s=0;case 6:if(!(s<o.length)){r.next=21;break}return l=o.slice(s,s+n),r.prev=8,r.delegateYield((0,c.default)().mark((function e(){var r;return(0,c.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.callFunction({name:"getWorkFiles",data:{workIds:l},spaceType:"aliyun"});case 2:r=e.sent,r.result&&r.result.success&&r.result.data&&Object.keys(r.result.data).forEach((function(e){var a=r.result.data[e];if(a){var n=[];a.cover&&n.push(a.cover),a.images&&Array.isArray(a.images)&&n.push.apply(n,(0,i.default)(a.images.filter((function(e){return e&&"string"===typeof e})))),a.thumbnails&&Array.isArray(a.thumbnails)&&n.push.apply(n,(0,i.default)(a.thumbnails.filter((function(e){return e&&"string"===typeof e})))),t.workImageFiles||(t.workImageFiles={}),t.workImageFiles[e]=n,t.imageTryIndex[e]=0,t.$forceUpdate()}}));case 4:case"end":return e.stop()}}),e)}))(),"t0",10);case 10:r.next=15;break;case 12:r.prev=12,r.t1=r["catch"](8),e.error("批次 ".concat(Math.floor(s/n)+1," 封面加载失败:"),r.t1);case 15:if(!(s+n<o.length)){r.next=18;break}return r.next=18,new Promise((function(e){return setTimeout(e,200)}));case 18:s+=n,r.next=6;break;case 21:r.next=26;break;case 23:r.prev=23,r.t2=r["catch"](0),e.error("异步加载封面失败:",r.t2);case 26:case"end":return r.stop()}}),r,null,[[0,23],[8,12]])})))()},loadWorks:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,t.loading=!0,t.userInfo&&t.userInfo._id){r.next=6;break}return e.error("用户信息不完整，无法加载作品"),uni.showToast({title:"用户信息异常，请重新登录",icon:"error"}),r.abrupt("return");case 6:return r.next=8,a.callFunction({name:"getUserAssignedWorks",data:{userId:t.userInfo._id},spaceType:"aliyun"});case 8:if(n=r.sent,!n.result||!n.result.success){r.next=17;break}return o=n.result.data||[],t.allWorks=o.map((function(e){return{id:e.work_id,workId:e.work_id,title:e.work_name,group:e.group,description:e.description,unit:e.unit,type:"视频"===e.group?"video":"image",thumbnail:"",scores:e.expert_scores||[],averageScores:e.average_scores||{},userHasRated:e.userHasRated,userScore:e.userScore,userTotalScore:e.userTotalScore}})),t.cacheWorksData(o),r.next=15,t.batchLoadWorkFiles();case 15:r.next=20;break;case 17:e.error("获取作品失败:",n.result&&n.result.message),uni.showToast({title:n.result&&n.result.message||"获取作品失败",icon:"error"}),t.allWorks=[];case 20:r.next=27;break;case 22:r.prev=22,r.t0=r["catch"](0),e.error("加载作品失败:",r.t0),uni.showToast({title:"网络错误，请稍后重试",icon:"error"}),t.allWorks=[];case 27:return r.prev=27,t.loading=!1,r.finish(27);case 30:case"end":return r.stop()}}),r,null,[[0,22,27,30]])})))()},initStaticFilePaths:function(){var t=this;try{if(!this.allWorks||0===this.allWorks.length)return void e.log("没有作品需要初始化文件路径");e.log("开始初始化静态文件路径"),this.allWorks.forEach((function(r){var a=r.id.toString(),n="https://rating-system-videos.oss-cn-hangzhou.aliyuncs.com",o=["".concat(n,"/videos/works/").concat(a,"/封面图.png"),"".concat(n,"/videos/works/").concat(a,"/封面图.jpg"),"".concat(n,"/videos/works/").concat(a,"/封面图.PNG"),"".concat(n,"/videos/works/").concat(a,"/封面图.JPG"),"".concat(n,"/videos/works/").concat(a,"/cover.png"),"".concat(n,"/videos/works/").concat(a,"/cover.jpg"),"".concat(n,"/videos/works/").concat(a,"/thumbnail.png"),"".concat(n,"/videos/works/").concat(a,"/thumbnail.jpg"),"".concat(n,"/videos/works/").concat(a,"/poster.png"),"".concat(n,"/videos/works/").concat(a,"/poster.jpg"),"".concat(n,"/videos/works/").concat(a,"/图片作品/1.png"),"".concat(n,"/videos/works/").concat(a,"/图片作品/1.jpg"),"".concat(n,"/videos/works/").concat(a,"/图文作品/1.png"),"".concat(n,"/videos/works/").concat(a,"/图文作品/1.jpg"),"".concat(n,"/videos/works/").concat(a,"/作品详情/作品图1.jpg"),"".concat(n,"/videos/works/").concat(a,"/作品详情/作品图1.png")];t.workImageFiles||(t.workImageFiles={}),t.workImageFiles[a]=o,t.imageTryIndex[a]=0,e.log("作品 ".concat(a," 初始化封面路径:"),o)})),this.$forceUpdate(),e.log("静态文件路径初始化完成")}catch(r){e.error("初始化静态文件路径失败:",r)}},batchLoadWorkFiles:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,t.allWorks&&0!==t.allWorks.length){r.next=4;break}return e.log("没有作品需要加载文件信息"),r.abrupt("return");case 4:return n=t.allWorks.map((function(e){return e.id})),e.log("批量获取作品文件信息，作品ID列表:",n),r.next=8,a.callFunction({name:"getWorkFiles",data:{workIds:n},spaceType:"aliyun"});case 8:o=r.sent,o.result&&o.result.success&&o.result.data?(e.log("批量获取文件信息成功:",o.result.data),Object.keys(o.result.data).forEach((function(r){var a=o.result.data[r];if(a){var n=[];a.cover&&n.push(a.cover),a.images&&Array.isArray(a.images)&&a.images.forEach((function(e){e&&"string"===typeof e&&n.push(e)})),a.thumbnails&&Array.isArray(a.thumbnails)&&a.thumbnails.forEach((function(e){e&&"string"===typeof e&&n.push(e)})),t.workImageFiles||(t.workImageFiles={}),t.workImageFiles[r]=n,t.imageTryIndex[r]=0;var i=t.allWorks.find((function(e){return e.id.toString()===r.toString()}));i&&a.videos&&a.videos.length>0&&(i.type="video",e.log("✓ 作品 ".concat(r," 根据文件信息更新为视频类型"))),e.log("作品 ".concat(r," 文件信息:"),n)}})),t.$forceUpdate()):e.warn("批量获取文件信息失败:",o.result),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),e.error("批量获取作品文件信息失败:",r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()},isWorkRatedByUser:function(e){var t=this;return e.hasOwnProperty("userHasRated")?e.userHasRated:!(!this.userInfo||!e.scores)&&e.scores.some((function(e){return e.expert_id===t.userInfo._id}))},getUserScore:function(e){var t=this;if(null!==e.userTotalScore&&void 0!==e.userTotalScore)return e.userTotalScore;if(!this.userInfo||!e.scores)return null;var r=e.scores.find((function(e){return e.expert_id===t.userInfo._id}));return r?r.total_score:null},isVisibleWork:function(e){return this.visibleWorkIds.has(e.id.toString())},isLoadingCover:function(e){return this.loadingCoverIds.has(e.id.toString())},isLoadedCover:function(e){return this.loadedCoverIds.has(e.id.toString())},getCoverLoadingClass:function(e){var t=e.id.toString();return this.loadingCoverIds.has(t)?"loading":this.visibleWorkIds.has(t)?"no-cover":"waiting"},filterWorkTitle:function(e){return e?e.replace(/[（(][^）)]*[）)]/g,"").trim():""},setFilter:function(e){this.currentFilter=e},checkAndRefreshWorks:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var a;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,a=uni.getStorageSync("needRefreshWorks"),!a){r.next=9;break}return e.log("检测到需要刷新作品列表标记，开始刷新"),uni.removeStorageSync("needRefreshWorks"),r.next=7,t.loadWorks();case 7:r.next=10;break;case 9:t.allWorks.length>0&&t.loadFromCache();case 10:r.next=18;break;case 12:if(r.prev=12,r.t0=r["catch"](0),e.error("检查刷新状态失败:",r.t0),!(t.allWorks.length>0)){r.next=18;break}return r.next=18,t.loadWorks();case 18:t.$nextTick((function(){t.initLazyCoverLoading()}));case 19:case"end":return r.stop()}}),r,null,[[0,12]])})))()},loadFromCache:function(){try{var t=uni.getStorageSync("userWorksCache");t&&Array.isArray(t)&&t.length>0&&(e.log("使用缓存数据更新作品列表"),this.allWorks=t.map((function(e){return{id:e.work_id||e.workId||e.id,workId:e.work_id||e.workId||e.id,title:e.work_name||e.title,group:e.group,description:e.description,unit:e.unit,type:"视频"===e.group?"video":"image",thumbnail:"",scores:e.expert_scores||e.scores||[],averageScores:e.average_scores||e.averageScores||{},userHasRated:e.userHasRated||e.isRated||!1,userScore:e.userScore,userTotalScore:e.userTotalScore}})),e.log("从缓存加载的作品数据:",this.allWorks.length,"个作品"))}catch(r){e.error("从缓存加载数据失败:",r)}},cacheWorksData:function(t){try{uni.setStorageSync("userWorksCache",t),e.log("作品数据已缓存到本地存储")}catch(r){e.error("缓存作品数据失败:",r)}},refreshWorks:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.log("手动刷新作品列表"),t.visibleWorkIds.clear(),t.loadingCoverIds.clear(),t.loadedCoverIds.clear(),t.workImageFiles={},t.confirmedImages={},t.imageTryIndex={},r.next=9,t.loadWorksOnly();case 9:t.loading||uni.showToast({title:"刷新成功",icon:"success",duration:1500});case 10:case"end":return r.stop()}}),r)})))()},goToWorkDetail:function(e){uni.navigateTo({url:"/pages/workDetail/workDetail?id=".concat(e)})},goBack:function(){uni.navigateTo({url:"/pages/profile/profile"})},getWorkThumbnail:function(t){if(!t||!t.id)return null;var r=t.id;try{if(this.confirmedImages&&this.confirmedImages[r])return this.confirmedImages[r];if(!this.workImageFiles||!this.workImageFiles[r])return null;var a=this.workImageFiles[r];if(a&&a.length>0){var n=this.imageTryIndex&&this.imageTryIndex[r]||0;if(n<a.length)return a[n]}return null}catch(o){return e.error("获取作品 ".concat(r," 缩略图时出错:"),o),null}},onThumbnailLoad:function(t){if(t&&t.target&&t.target.src){var r=t.target.src;e.log("缩略图加载成功:",r);try{var a=r.match(/works\/(\d+)\//);if(a){var n=a[1];this.confirmedImages||(this.confirmedImages={}),this.confirmedImages[n]=r,e.log("作品 ".concat(n," 图片路径已确认:"),r)}}catch(o){e.error("处理缩略图加载成功事件时出错:",o)}}},onThumbnailError:function(t){if(t&&t.target)try{var r=t.target.src||"unknown";e.log("缩略图加载失败:",r),t.target.style&&(t.target.style.display="none")}catch(a){e.error("处理缩略图加载失败事件时出错:",a)}},testFileAccess:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var a,n;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.testingFile=!0,t.testResult=null,a="https://mp-80ce172e-5f88-499c-8ff7-44e4beddeb34.cdn.bspapp.com/works/1/封面图.png",r.prev=3,e.log("开始测试文件获取:",a),r.next=7,t.testImageLoad(a);case 7:if(n=r.sent,!n.success){r.next=13;break}t.testResult={success:!0,message:"✅ 文件获取成功！图片大小: ".concat(n.width,"x").concat(n.height,"px"),imageUrl:a,details:{width:n.width,height:n.height,loadTime:n.loadTime}},uni.showToast({title:"文件获取成功！",icon:"success"}),r.next=14;break;case 13:throw new Error(n.error);case 14:r.next=29;break;case 16:return r.prev=16,r.t0=r["catch"](3),e.error("文件获取测试失败:",r.t0),t.testResult={success:!1,message:"❌ 文件获取失败: ".concat(r.t0.message),imageUrl:null},r.prev=20,r.next=23,t.testWithFetch(a);case 23:r.next=28;break;case 25:r.prev=25,r.t1=r["catch"](20),e.error("Fetch 测试也失败:",r.t1);case 28:uni.showToast({title:"文件获取失败",icon:"error"});case 29:return r.prev=29,t.testingFile=!1,r.finish(29);case 32:case"end":return r.stop()}}),r,null,[[3,16,29,32],[20,25]])})))()},testImageLoad:function(t){return new Promise((function(r){var a=Date.now(),n=new Image,o=setTimeout((function(){n.onload=null,n.onerror=null,r({success:!1,error:"加载超时（10秒）"})}),1e4);n.onload=function(){clearTimeout(o);var i=Date.now()-a;e.log("图片加载成功: ".concat(t,", 耗时: ").concat(i,"ms, 尺寸: ").concat(n.width,"x").concat(n.height)),r({success:!0,width:n.width,height:n.height,loadTime:i})},n.onerror=function(t){clearTimeout(o),e.error("图片加载失败:",t),r({success:!1,error:"图片加载失败"})},n.src=t}))},testWithFetch:function(t){return(0,l.default)((0,c.default)().mark((function r(){var a;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.log("尝试使用 fetch 测试文件访问"),r.prev=1,r.next=4,fetch(t,{method:"HEAD",mode:"cors"});case 4:a=r.sent,e.log("Fetch 测试结果:",{status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries())}),a.ok?e.log("✅ Fetch 测试成功"):e.log("❌ Fetch 测试失败:",a.status,a.statusText),r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](1),e.error("❌ Fetch 测试异常:",r.t0);case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))()},onTestImageLoad:function(t){e.log("测试图片显示成功:",t.target.src),this.testResult&&(this.testResult.message+=" (图片显示正常)")},onTestImageError:function(t){e.error("测试图片显示失败:",t.target.src),this.testResult&&(this.testResult.message+=" (图片显示异常)",this.testResult.success=!1)},listAllWorksFiles:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loadingStorageFiles){r.next=2;break}return r.abrupt("return");case 2:return t.loadingStorageFiles=!0,r.prev=3,uni.showLoading({title:"扫描云存储...",mask:!0}),e.log("开始获取云存储文件列表..."),r.next=8,a.callFunction({name:"listWorksFiles",data:{prefix:"works/",maxKeys:1e3},spaceType:"aliyun",timeout:6e4});case 8:n=r.sent,e.log("云存储文件扫描结果:",n),n.result&&n.result.success?(t.storageFiles=n.result.data.files||[],t.storageFolders=n.result.data.folders||[],uni.hideLoading(),uni.showToast({title:"找到 ".concat(t.storageFiles.length," 个文件"),icon:"success",duration:2e3}),e.log("文件扫描统计:",{"总文件数":t.storageFiles.length,"文件夹数":t.storageFolders.length,"扫描方法":n.result.data.scanMethod,"文件夹列表":t.storageFolders})):(uni.hideLoading(),o=n.result&&n.result.message||"获取文件列表失败",uni.showToast({title:o,icon:"error",duration:3e3}),e.error("获取云存储文件失败:",n)),r.next=18;break;case 13:r.prev=13,r.t0=r["catch"](3),uni.hideLoading(),e.error("调用listWorksFiles云函数失败:",r.t0),uni.showToast({title:"网络错误，请重试",icon:"error",duration:3e3});case 18:return r.prev=18,t.loadingStorageFiles=!1,r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[3,13,18,21]])})))()},copyFilePath:function(e){uni.setClipboardData({data:e,success:function(){uni.showToast({title:"路径已复制",icon:"success",duration:1500})},fail:function(){uni.showToast({title:"复制失败",icon:"error"})}})},getFileTypeIcon:function(e){return{image:"🖼️",video:"🎥",audio:"🎵",other:"📄"}[e]||"📄"},getFileTypeStyle:function(e){return{image:"color: #10b981;",video:"color: #ef4444;",audio:"color: #8b5cf6;",other:"color: #6b7280;"}[e]||"color: #6b7280;"},checkVideoFileInfo:function(t){var r=this;return(0,l.default)((0,c.default)().mark((function a(){return(0,c.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.log("开始检查视频文件信息:",t),a.abrupt("return",new Promise((function(a){var n=document.createElement("video");n.preload="metadata",n.muted=!0;var o=setTimeout((function(){a({success:!1,error:"视频文件检查超时",details:null})}),15e3);n.onloadedmetadata=function(){clearTimeout(o);var t={duration:n.duration,videoWidth:n.videoWidth,videoHeight:n.videoHeight,videoTracks:n.videoTracks&&n.videoTracks.length||0,audioTracks:n.audioTracks&&n.audioTracks.length||0,networkState:n.networkState,readyState:n.readyState,canPlayType_mp4:n.canPlayType("video/mp4"),canPlayType_webm:n.canPlayType("video/webm"),canPlayType_ogg:n.canPlayType("video/ogg")};e.log("视频文件信息:",t),a({success:!0,info:t,recommendations:r.getVideoRecommendations(t)})},n.onerror=function(t){clearTimeout(o),e.error("视频文件检查失败:",t);var i={code:n.error&&n.error.code||null,message:r.getVideoErrorMessage(n.error&&n.error.code||null),networkState:n.networkState,readyState:n.readyState};a({success:!1,error:i.message,details:i,recommendations:["检查文件格式是否为MP4","确认文件未损坏","检查网络连接"]})},n.src=t})));case 2:case"end":return a.stop()}}),a)})))()},getVideoErrorMessage:function(e){return{1:"用户中止了视频下载",2:"网络错误导致视频下载失败",3:"视频解码失败 - 可能是编码格式不支持",4:"视频格式不受支持"}[e]||"未知错误 (代码: ".concat(e,")")},getVideoRecommendations:function(e){var t=[];return e.duration&&0!==e.duration||t.push("⚠️ 视频时长为0，可能文件损坏"),0!==e.videoWidth&&0!==e.videoHeight||t.push("⚠️ 视频尺寸为0，可能缺少视频轨道"),0===e.audioTracks&&t.push("⚠️ 缺少音频轨道，建议添加静音音轨"),""===e.canPlayType_mp4&&t.push("⚠️ 浏览器不支持MP4格式"),(e.videoWidth>1920||e.videoHeight>1080)&&t.push("💡 建议压缩到1080p以下以提高兼容性"),0===t.length&&t.push("✅ 视频格式看起来正常"),t},testVideoCompatibility:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var a,n,i,l,u,d,f;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(0!==t.storageFiles.length){r.next=3;break}return uni.showToast({title:"请先扫描云存储文件",icon:"none"}),r.abrupt("return");case 3:if(a=t.storageFiles.filter((function(e){return"video"===e.type})),0!==a.length){r.next=7;break}return uni.showToast({title:"未发现视频文件",icon:"none"}),r.abrupt("return");case 7:uni.showLoading({title:"检查视频兼容性...",mask:!0}),n=[],i=(0,o.default)(a.slice(0,3)),r.prev=10,i.s();case 12:if((l=i.n()).done){r.next=22;break}return u=l.value,e.log("检查视频: ".concat(u.name)),d="https://mp-80ce172e-5f88-499c-8ff7-44e4beddeb34.cdn.bspapp.com/".concat(u.path),r.next=18,t.checkVideoFileInfo(d);case 18:f=r.sent,n.push((0,s.default)({fileName:u.name,filePath:u.path,url:d},f));case 20:r.next=12;break;case 22:r.next=27;break;case 24:r.prev=24,r.t0=r["catch"](10),i.e(r.t0);case 27:return r.prev=27,i.f(),r.finish(27);case 30:uni.hideLoading(),t.showVideoCompatibilityResults(n);case 32:case"end":return r.stop()}}),r,null,[[10,24,27,30]])})))()},showVideoCompatibilityResults:function(t){e.log("视频兼容性检查结果:",t);t.map((function(e){var t=e.success?"✅":"❌",r=e.recommendations&&e.recommendations.join("<br>")||"";return'\n          <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #eee; border-radius: 5px;">\n            <div style="font-weight: bold;">'.concat(t," ").concat(e.fileName,'</div>\n            <div style="font-size: 12px; color: #666; margin: 5px 0;">\n              ').concat(e.success?"视频信息正常":e.error,'\n            </div>\n            <div style="font-size: 11px; color: #888;">\n              ').concat(r,"\n            </div>\n          </div>\n        ")})).join("");uni.showModal({title:"视频兼容性检查结果",content:"请查看控制台获取详细信息",showCancel:!1,confirmText:"查看控制台"})},loadLocalVideoFiles:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o,i,s;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loadingLocalVideos){r.next=2;break}return r.abrupt("return");case 2:return t.loadingLocalVideos=!0,r.prev=3,uni.showLoading({title:"加载本地视频...",mask:!0}),n=t.allWorks.map((function(e){return e.id})).slice(0,10),e.log("获取本地视频文件配置，作品ID:",n),r.next=9,a.callFunction({name:"getLocalVideoFiles",data:{workIds:n,includeDemo:!0},spaceType:"aliyun",timeout:3e4});case 9:o=r.sent,e.log("本地视频文件查询结果:",o),o.result&&o.result.success?(t.localVideoFiles=o.result.data||{},uni.hideLoading(),i=Object.keys(t.localVideoFiles).length,uni.showToast({title:"找到 ".concat(i," 个作品配置"),icon:"success",duration:2e3}),e.log("本地视频配置加载完成:",{"总作品数":i,"配置详情":t.localVideoFiles})):(uni.hideLoading(),s=o.result&&o.result.message||"获取本地视频配置失败",uni.showToast({title:s,icon:"error",duration:3e3}),e.error("获取本地视频配置失败:",o)),r.next=19;break;case 14:r.prev=14,r.t0=r["catch"](3),uni.hideLoading(),e.error("调用getLocalVideoFiles云函数失败:",r.t0),uni.showToast({title:"网络错误，请重试",icon:"error",duration:3e3});case 19:return r.prev=19,t.loadingLocalVideos=!1,r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[3,14,19,22]])})))()},testLocalVideo:function(t){var r=this;return(0,l.default)((0,c.default)().mark((function a(){var n;return(0,c.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.log("测试本地视频播放:",t),a.prev=1,uni.showLoading({title:"测试视频播放...",mask:!0}),a.next=5,r.checkVideoFileInfo(t);case 5:n=a.sent,uni.hideLoading(),n.success?r.showVideoPlayer(t,n.info):uni.showModal({title:"视频测试失败",content:n.error+"\n\n建议：\n1. 确认文件是否存在\n2. 检查文件路径是否正确\n3. 确认视频格式是否支持",showCancel:!1,confirmText:"知道了"}),a.next=15;break;case 10:a.prev=10,a.t0=a["catch"](1),uni.hideLoading(),e.error("测试本地视频失败:",a.t0),uni.showToast({title:"测试失败",icon:"error"});case 15:case"end":return a.stop()}}),a,null,[[1,10]])})))()},testLocalImage:function(t){return(0,l.default)((0,c.default)().mark((function r(){var a;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:e.log("测试本地图片:",t);try{a=new Image,a.onload=function(){e.log("图片加载成功:",{url:t,width:a.width,height:a.height}),uni.showModal({title:"图片测试成功",content:"图片尺寸: ".concat(a.width,"x").concat(a.height,"px"),showCancel:!1,confirmText:"知道了"})},a.onerror=function(){e.error("图片加载失败:",t),uni.showModal({title:"图片测试失败",content:"无法加载图片文件\n\n建议：\n1. 确认文件是否存在\n2. 检查文件路径是否正确\n3. 确认图片格式是否支持",showCancel:!1,confirmText:"知道了"})},a.src=t}catch(n){e.error("测试本地图片失败:",n),uni.showToast({title:"测试失败",icon:"error"})}case 2:case"end":return r.stop()}}),r)})))()},showVideoPlayer:function(t,r){var a='\n        <div style="text-align: center; padding: 20px;">\n          <video controls style="max-width: 100%; max-height: 400px;" autoplay>\n            <source src="'.concat(t,'" type="video/mp4">\n            您的浏览器不支持视频播放\n          </video>\n          <div style="margin-top: 10px; font-size: 12px; color: #666;">\n            <div>尺寸: ').concat(r.videoWidth,"x").concat(r.videoHeight,"</div>\n            <div>时长: ").concat(this.formatDuration(r.duration),"</div>\n          </div>\n        </div>\n      ");uni.showModal({title:"视频播放测试",content:"视频播放成功！请查看浏览器控制台获取详细信息。",showCancel:!1,confirmText:"关闭"}),e.log("视频播放器HTML:",a),e.log("视频信息:",r)},showServerStats:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,o;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loadingServerStats){r.next=2;break}return r.abrupt("return");case 2:return t.loadingServerStats=!0,r.prev=3,uni.showLoading({title:"检测服务器负载...",mask:!0}),e.log("开始获取服务器统计信息..."),r.next=8,a.callFunction({name:"getServerStats",data:{action:"getStats"},spaceType:"aliyun",timeout:3e4});case 8:n=r.sent,e.log("服务器统计查询结果:",n),n.result&&n.result.success?(t.serverStats=n.result.data,uni.hideLoading(),uni.showToast({title:"负载检测完成",icon:"success",duration:1500}),e.log("服务器统计信息:",t.serverStats)):(uni.hideLoading(),o=n.result&&n.result.message||"获取服务器统计失败",uni.showToast({title:o,icon:"error",duration:3e3}),e.error("获取服务器统计失败:",n)),r.next=18;break;case 13:r.prev=13,r.t0=r["catch"](3),uni.hideLoading(),e.error("调用getServerStats云函数失败:",r.t0),uni.showToast({title:"网络错误，请重试",icon:"error",duration:3e3});case 18:return r.prev=18,t.loadingServerStats=!1,r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[3,13,18,21]])})))()},getConnectionStatusText:function(e){return{healthy:"✅ 正常",warning:"⚠️ 警告",error:"❌ 异常"}[e]||"❓ 未知"},formatTimestamp:function(e){if(!e)return"未知";var t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},startConcurrentTest:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var a,n,o,i,s,l,u,d,f,p;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.runningConcurrentTest){r.next=2;break}return r.abrupt("return");case 2:for(t.runningConcurrentTest=!0,t.concurrentTestResults=null,r.prev=4,uni.showLoading({title:"并发测试中...",mask:!0}),e.log("开始并发访问测试..."),a=5,n=[],o=Date.now(),"/rating-system-web/static/videos/demo/sample.mp4",i=0;i<a;i++)n.push(t.testSingleRequest("/rating-system-web/static/videos/demo/sample.mp4",i+1));return r.next=14,Promise.allSettled(n);case 14:s=r.sent,l=Date.now(),u=s.filter((function(e){return"fulfilled"===e.status&&e.value.success})).length,d=s.filter((function(e){return"rejected"===e.status||!e.value.success})).length,f=l-o,p=f/a,t.concurrentTestResults={success:u,failed:d,avgResponseTime:Math.round(p),totalTime:f,concurrentCount:a},uni.hideLoading(),e.log("并发测试结果:",{"总请求数":a,"成功":u,"失败":d,"总耗时":f+"ms","平均响应时间":p+"ms"}),u===a?uni.showToast({title:"✅ 并发测试通过 (".concat(u,"/").concat(a,")"),icon:"success",duration:2e3}):uni.showToast({title:"⚠️ 部分请求失败 (".concat(u,"/").concat(a,")"),icon:"none",duration:2e3}),r.next=31;break;case 26:r.prev=26,r.t0=r["catch"](4),uni.hideLoading(),e.error("并发测试失败:",r.t0),uni.showToast({title:"并发测试失败",icon:"error",duration:3e3});case 31:return r.prev=31,t.runningConcurrentTest=!1,r.finish(31);case 34:case"end":return r.stop()}}),r,null,[[4,26,31,34]])})))()},testSingleRequest:function(t,r){return(0,l.default)((0,c.default)().mark((function a(){var n,o,i,s,l,u;return(0,c.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=Date.now(),a.prev=1,e.log("请求 ".concat(r," 开始: ").concat(t)),a.next=5,fetch(t,{method:"HEAD",cache:"no-cache"});case 5:return o=a.sent,i=Date.now(),s=i-n,e.log("请求 ".concat(r," 完成: ").concat(o.status,", 耗时: ").concat(s,"ms")),a.abrupt("return",{success:o.ok,status:o.status,responseTime:s,requestId:r});case 12:return a.prev=12,a.t0=a["catch"](1),l=Date.now(),u=l-n,e.error("请求 ".concat(r," 失败:"),a.t0),a.abrupt("return",{success:!1,error:a.t0.message,responseTime:u,requestId:r});case 18:case"end":return a.stop()}}),a,null,[[1,12]])})))()},loadLocalCovers:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,i,s,l,u,d,f,p,h,g;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loadingLocalCovers&&t.allWorks&&0!==t.allWorks.length){r.next=2;break}return r.abrupt("return");case 2:return t.loadingLocalCovers=!0,r.prev=3,e.log("🔍 开始通过云函数读取本地封面图片..."),n=t.allWorks.map((function(e){return e.id})).slice(0,20),e.log("需要读取的作品ID:",n),r.next=9,a.callFunction({name:"readWorkFolders",data:{workIds:n},spaceType:"aliyun",timeout:3e4});case 9:if(i=r.sent,e.log("云函数读取结果:",i),i.result&&i.result.success){s=i.result.data||{},l={},u=0,d=(0,o.default)(n);try{for(d.s();!(f=d.n()).done;)p=f.value,h=s[p],h&&h.exists&&h.coverImage?(l[p]={workId:p,hasCover:!0,coverUrl:h.coverUrl,primaryImage:h.coverImage,detectedImages:h.imageFiles||[],totalImages:h.imageFiles?h.imageFiles.length:0,detectionMethod:"folder_read",source:"cloud_function"},u++,e.log("✅ 作品 ".concat(p," 找到封面: ").concat(h.coverImage.fileName))):(l[p]={workId:p,hasCover:!1,coverUrl:null,primaryImage:null,detectedImages:h&&h.imageFiles?h.imageFiles:[],totalImages:0,detectionMethod:"folder_read",source:"cloud_function",error:h?h.error:"未知错误"},e.log("❌ 作品 ".concat(p," 未找到封面:"),h?h.error:"数据为空"))}catch(c){d.e(c)}finally{d.f()}t.localCovers=l,e.log("本地封面读取完成:",{"扫描作品数":n.length,"有封面":u,"无封面":n.length-u,"封面详情":t.localCovers}),u>0?(uni.showToast({title:"📸 找到 ".concat(u," 个本地封面"),icon:"success",duration:2e3}),setTimeout((function(){t.preloadCriticalCovers()}),1e3)):uni.showToast({title:"未找到封面文件，请检查文件夹",icon:"none",duration:3e3})}else e.error("云函数调用失败:",i),g=i.result&&i.result.message||"云函数调用失败",uni.showToast({title:g,icon:"error",duration:3e3});r.next=18;break;case 14:r.prev=14,r.t0=r["catch"](3),e.error("读取本地封面失败:",r.t0),uni.showToast({title:"读取封面失败: "+r.t0.message,icon:"error",duration:3e3});case 18:return r.prev=18,t.loadingLocalCovers=!1,r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[3,14,18,21]])})))()},refreshLocalCovers:function(){var e=this;return(0,l.default)((0,c.default)().mark((function t(){return(0,c.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$forceUpdate(),uni.showToast({title:"封面已刷新",icon:"success",duration:1500});case 2:case"end":return t.stop()}}),t)})))()},getCoverStatusIcon:function(e){return"📸"},getCoverDebugInfo:function(e){return"封面: 封面图.png"},onCoverImageError:function(t,r){if(r&&r.target&&t)try{var a=t.id,n=r.target.src||"unknown";e.warn("作品 ".concat(a," 图片加载失败:"),n),this.imageTryIndex||(this.imageTryIndex={});var o=this.imageTryIndex[a]||0,i=o+1;this.imageTryIndex[a]=i;var s=this.workImageFiles&&this.workImageFiles[a];if(s&&i<s.length){var c=s[i];e.log("作品 ".concat(a," 尝试下一个图片: ").concat(c)),r.target.src=c}else e.log("作品 ".concat(a," 所有图片都尝试过了，隐藏图片")),r.target.style&&(r.target.style.display="none")}catch(l){e.error("处理封面图片加载错误时出错:",l)}},tryFallbackCover:function(t,r){var a=this;return(0,l.default)((0,c.default)().mark((function n(){var o,i,s,l;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=a.localCovers[t.id],!(o&&o.detectedImages&&o.detectedImages.length>1)){n.next=9;break}if(i=r.src,s=o.detectedImages.findIndex((function(e){return e.url===i})),!(-1!==s&&s<o.detectedImages.length-1)){n.next=9;break}return l=o.detectedImages[s+1],e.log("尝试备用封面: ".concat(l.url)),a.localCovers[t.id]&&(a.localCovers[t.id].coverUrl=l.url,a.localCovers[t.id].primaryImage=l),n.abrupt("return");case 9:a.localCovers[t.id]&&(a.localCovers[t.id].hasCover=!1,a.localCovers[t.id].coverUrl=null,a.localCovers[t.id].errorMessage="图片加载失败"),e.log("作品 ".concat(t.id," 无可用封面"));case 11:case"end":return n.stop()}}),n)})))()},isCoverLoadFailed:function(e){return this.coverLoadErrors.has(e.id)},retryCoverLoad:function(t){var r=this;return(0,l.default)((0,c.default)().mark((function n(){var o;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r.coverLoadErrors.delete(t.id),n.prev=1,n.next=4,a.callFunction({name:"getLocalWorkCovers",data:{workIds:[t.id],detectMode:"auto"},spaceType:"aliyun",timeout:15e3});case 4:o=n.sent,o.result&&o.result.success&&o.result.data[t.id]&&(r.localCovers[t.id]=o.result.data[t.id],uni.showToast({title:"封面重新加载完成",icon:"success",duration:1500})),n.next=12;break;case 8:n.prev=8,n.t0=n["catch"](1),e.error("重试加载作品 ".concat(t.id," 封面失败:"),n.t0),uni.showToast({title:"重试失败",icon:"error",duration:1500});case 12:case"end":return n.stop()}}),n,null,[[1,8]])})))()},preloadCriticalCovers:function(){if(this.localCovers&&0!==Object.keys(this.localCovers).length){e.log("开始预加载关键封面图片...");var t=Object.values(this.localCovers).filter((function(e){return e.hasCover&&e.coverUrl})).slice(0,5);t.forEach((function(t,r){setTimeout((function(){var r=new Image;r.onload=function(){e.log("预加载封面成功: ".concat(t.coverUrl))},r.onerror=function(){e.warn("预加载封面失败: ".concat(t.coverUrl))},r.src=t.coverUrl}),100*r)}))}},getCoverLoadingState:function(e){var t=this.localCovers[e.id];if(!t)return{loading:!0,error:!1,loaded:!1};var r=this.coverLoadErrors.has(e.id),a=t.hasCover&&!r;return{loading:!a&&!r,error:r,loaded:a}},optimizeCoverLoading:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var a,n,i,s;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.preloadCriticalCovers(),a=Array.from(t.coverLoadErrors),!(a.length>0)){r.next=20;break}e.log("发现 ".concat(a.length," 个加载失败的封面，尝试重新检测...")),n=(0,o.default)(a),r.prev=5,s=(0,c.default)().mark((function e(){var r,a;return(0,c.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=i.value,a=t.allWorks.find((function(e){return e.id===r})),!a){e.next=7;break}return e.next=5,t.retryCoverLoad(a);case 5:return e.next=7,new Promise((function(e){return setTimeout(e,200)}));case 7:case"end":return e.stop()}}),e)})),n.s();case 8:if((i=n.n()).done){r.next=12;break}return r.delegateYield(s(),"t0",10);case 10:r.next=8;break;case 12:r.next=17;break;case 14:r.prev=14,r.t1=r["catch"](5),n.e(r.t1);case 17:return r.prev=17,n.f(),r.finish(17);case 20:e.log("封面加载优化完成");case 21:case"end":return r.stop()}}),r,null,[[5,14,17,20]])})))()},scanWorkCoverImages:function(t){var r=this;return(0,l.default)((0,c.default)().mark((function a(){var n,o,i;return(0,c.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n="/rating-system-web/static/videos/works/".concat(t,"/"),e.log("开始扫描作品 ".concat(t," 文件夹中的所有图片文件...")),a.next=4,r.scanAllImagesInFolder(n,t);case 4:if(o=a.sent,e.log("作品 ".concat(t," 扫描结果: 找到 ").concat(o.length," 个图片")),0!==o.length){a.next=8;break}return a.abrupt("return",{workId:t,hasCover:!1,coverUrl:null,primaryImage:null,detectedImages:[],totalImages:0,detectionMethod:"folder_scan"});case 8:return o.sort((function(e,t){return e.priority!==t.priority?e.priority-t.priority:t.confidence-e.confidence})),i=o[0],e.log("作品 ".concat(t," 选择封面: ").concat(i.name," (优先级: ").concat(i.priority,", 置信度: ").concat(i.confidence,")")),e.log("作品 ".concat(t," 所有可用图片:"),o.map((function(e){return e.name}))),a.abrupt("return",{workId:t,hasCover:!0,coverUrl:i.url,primaryImage:i,detectedImages:o,totalImages:o.length,detectionMethod:"folder_scan"});case 13:case"end":return a.stop()}}),a)})))()},testImageExists:function(e){return(0,l.default)((0,c.default)().mark((function t(){return(0,c.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=new Image,a=setTimeout((function(){t(!1)}),3e3);r.onload=function(){clearTimeout(a),t(!0)},r.onerror=function(){clearTimeout(a),t(!1)},r.src=e})));case 1:case"end":return t.stop()}}),t)})))()},calculateLocalFilePriority:function(e){var t=e.toLowerCase();if("cover"===t)return 1;if("thumbnail"===t)return 2;if("poster"===t)return 3;if("image"===t)return 4;if("pic"===t)return 5;if("img"===t)return 6;if("main"===t)return 7;if("photo"===t)return 8;if(/^\d+$/.test(t)){var r=parseInt(t);return 10+r}return 50},calculateLocalImageConfidence:function(e,t){var r=.6,a=e.toLowerCase();if("cover"===a)r+=.3;else if("thumbnail"===a)r+=.25;else if("poster"===a)r+=.25;else if("image"===a)r+=.2;else if("pic"===a)r+=.15;else if("img"===a)r+=.15;else if("photo"===a)r+=.1;else if(/^\d+$/.test(a)){var n=parseInt(a);r+=1===n?.2:n<=3?.15:n<=5?.1:.05}else r+=.1;return"jpg"===t||"jpeg"===t||"png"===t?r+=.1:"webp"===t?r+=.05:"gif"===t&&(r+=.03),Math.min(r,1)},scanAllImagesInFolder:function(t,r){var a=this;return(0,l.default)((0,c.default)().mark((function n(){var o,s,l,u,d,f,p,h,g,v;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=[],s=["jpg","jpeg","png","gif","webp","bmp"],e.log("🔍 全面扫描作品 ".concat(r," 的图片文件...")),n.next=5,a.scanCommonPatterns(t,s);case 5:return l=n.sent,o.push.apply(o,(0,i.default)(l)),n.next=9,a.scanNumberedFiles(t,s,20);case 9:return u=n.sent,o.push.apply(o,(0,i.default)(u)),n.next=13,a.scanOtherPossibleFiles(t,s);case 13:for(d=n.sent,o.push.apply(o,(0,i.default)(d)),f=[],p=new Set,h=0,g=o;h<g.length;h++)v=g[h],p.has(v.url)||(p.add(v.url),f.push(v));return e.log("作品 ".concat(r," 发现的所有图片:"),f.map((function(e){return"".concat(e.name," (").concat(e.source,")")}))),n.abrupt("return",f);case 20:case"end":return n.stop()}}),n)})))()},scanCommonPatterns:function(t,r){var a=this;return(0,l.default)((0,c.default)().mark((function n(){var i,s,l,u,d,f,p,h,g;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=["cover","thumbnail","poster","image","pic","img","main","default","preview","snapshot","photo","fengmian","tupian","zhaopian"],s=[],l=0,u=i;case 3:if(!(l<u.length)){n.next=29;break}d=u[l],f=(0,o.default)(r),n.prev=6,f.s();case 8:if((p=f.n()).done){n.next=18;break}return h=p.value,g="".concat(t).concat(d,".").concat(h),n.next=13,a.testImageExists(g);case 13:if(!n.sent){n.next=16;break}s.push({name:"".concat(d,".").concat(h),url:g,format:h,fileName:d,priority:a.calculateLocalFilePriority(d),confidence:a.calculateLocalImageConfidence(d,h),source:"common_pattern"}),e.log("✅ 找到常见模式图片: ".concat(d,".").concat(h));case 16:n.next=8;break;case 18:n.next=23;break;case 20:n.prev=20,n.t0=n["catch"](6),f.e(n.t0);case 23:return n.prev=23,f.f(),n.finish(23);case 26:l++,n.next=3;break;case 29:return n.abrupt("return",s);case 30:case"end":return n.stop()}}),n,null,[[6,20,23,26]])})))()},scanNumberedFiles:function(t,r){var a=arguments,n=this;return(0,l.default)((0,c.default)().mark((function i(){var s,l,u,d,f,p,h;return(0,c.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:s=a.length>2&&void 0!==a[2]?a[2]:50,l=[],u=1;case 3:if(!(u<=s)){i.next=28;break}d=(0,o.default)(r),i.prev=5,d.s();case 7:if((f=d.n()).done){i.next=17;break}return p=f.value,h="".concat(t).concat(u,".").concat(p),i.next=12,n.testImageExists(h);case 12:if(!i.sent){i.next=15;break}l.push({name:"".concat(u,".").concat(p),url:h,format:p,fileName:u.toString(),priority:n.calculateLocalFilePriority(u.toString()),confidence:n.calculateLocalImageConfidence(u.toString(),p),source:"numbered"}),e.log("✅ 找到数字命名图片: ".concat(u,".").concat(p));case 15:i.next=7;break;case 17:i.next=22;break;case 19:i.prev=19,i.t0=i["catch"](5),d.e(i.t0);case 22:return i.prev=22,d.f(),i.finish(22);case 25:u++,i.next=3;break;case 28:return i.abrupt("return",l);case 29:case"end":return i.stop()}}),i,null,[[5,19,22,25]])})))()},scanOtherPossibleFiles:function(t,r){var a=this;return(0,l.default)((0,c.default)().mark((function n(){var i,s,l,u,d,f,p,h,g;return(0,c.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=["work","artwork","design","creation","project","demo","sample","example","test","w","p","i","d","t","2024","2023","01","02","03","final","draft","version","new","old"],s=[],l=0,u=i;case 3:if(!(l<u.length)){n.next=29;break}d=u[l],f=(0,o.default)(r),n.prev=6,f.s();case 8:if((p=f.n()).done){n.next=18;break}return h=p.value,g="".concat(t).concat(d,".").concat(h),n.next=13,a.testImageExists(g);case 13:if(!n.sent){n.next=16;break}s.push({name:"".concat(d,".").concat(h),url:g,format:h,fileName:d,priority:a.calculateLocalFilePriority(d),confidence:a.calculateLocalImageConfidence(d,h),source:"other_pattern"}),e.log("✅ 找到其他模式图片: ".concat(d,".").concat(h));case 16:n.next=8;break;case 18:n.next=23;break;case 20:n.prev=20,n.t0=n["catch"](6),f.e(n.t0);case 23:return n.prev=23,f.f(),n.finish(23);case 26:l++,n.next=3;break;case 29:return n.abrupt("return",s);case 30:case"end":return n.stop()}}),n,null,[[6,20,23,26]])})))()},testFolderRead:function(){var t=this;return(0,l.default)((0,c.default)().mark((function r(){var n,i,s,l,u,d,f,p,h;return(0,c.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.log("🧪 开始测试文件夹读取功能..."),r.prev=1,uni.showLoading({title:"测试文件夹读取...",mask:!0}),n=t.allWorks.slice(0,3).map((function(e){return e.id})),e.log("测试作品ID:",n),r.next=7,a.callFunction({name:"readWorkFolders",data:{workIds:n},spaceType:"aliyun",timeout:3e4});case 7:if(i=r.sent,uni.hideLoading(),e.log("📋 文件夹读取测试结果:",i),i.result&&i.result.success){s=i.result.data,l="文件夹读取测试结果:\n\n",u=(0,o.default)(n);try{for(u.s();!(d=u.n()).done;)f=d.value,p=s[f],p&&(l+="作品 ".concat(f,":\n"),l+="- 文件夹存在: ".concat(p.exists?"是":"否","\n"),l+="- 总文件数: ".concat(p.totalFiles||0,"\n"),l+="- 图片文件数: ".concat(p.imageFiles?p.imageFiles.length:0,"\n"),l+="- 封面: ".concat(p.coverImage?p.coverImage.fileName:"无","\n"),p.imageFiles&&p.imageFiles.length>0&&(l+="- 所有图片: ".concat(p.imageFiles.map((function(e){return e.fileName})).join(", "),"\n")),p.error&&(l+="- 错误: ".concat(p.error,"\n")),l+="\n")}catch(c){u.e(c)}finally{u.f()}uni.showModal({title:"文件夹读取测试",content:l,showCancel:!1,confirmText:"确定"})}else h=i.result&&i.result.message||"测试失败",uni.showModal({title:"测试失败",content:"云函数调用失败: ".concat(h),showCancel:!1,confirmText:"确定"});r.next=18;break;case 13:r.prev=13,r.t0=r["catch"](1),uni.hideLoading(),e.error("文件夹读取测试失败:",r.t0),uni.showModal({title:"测试异常",content:"测试过程中发生错误: ".concat(r.t0.message),showCancel:!1,confirmText:"确定"});case 18:case"end":return r.stop()}}),r,null,[[1,13]])})))()}}};t.default=u}).call(this,r("ba7c")["default"],r("861b")["uniCloud"])},1052:function(e,t,r){"use strict";var a=r("85c1"),n=r("69e4"),o=r("474f"),i=r("8466"),s=r("ca99"),c=r("8c08"),l=r("897c"),u=r("6b21"),d=r("a734"),f=r("0173"),p=n&&n.prototype,h=c("species"),g=!1,v=o(a.PromiseRejectionEvent),m=i("Promise",(function(){var e=s(n),t=e!==String(n);if(!t&&66===f)return!0;if(d&&(!p["catch"]||!p["finally"]))return!0;if(!f||f<51||!/native code/.test(e)){var r=new n((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))},o=r.constructor={};if(o[h]=a,g=r.then((function(){}))instanceof a,!g)return!0}return!t&&(l||u)&&!v}));e.exports={CONSTRUCTOR:m,REJECTION_EVENT:v,SUBCLASSING:g}},1987:function(e,t,r){var a=r("c86c");t=a(!1),t.push([e.i,"*[data-v-39ada80c]{margin:0;padding:0;box-sizing:border-box}.works-container[data-v-39ada80c]{padding:16px;padding-top:0;min-height:100vh;background-color:#f8fafc;max-width:1200px;margin:0 auto}\n\n/* 自定义标题栏 */.custom-header[data-v-39ada80c]{background:linear-gradient(135deg,#4568dc,#b06ab3);color:#fff;padding:16px;position:-webkit-sticky;position:sticky;top:0;z-index:100;margin:-16px -16px 16px -16px}.header-content[data-v-39ada80c]{max-width:1200px;margin:0 auto;padding:0 16px;display:flex;align-items:center;justify-content:space-between;height:44px}.header-title[data-v-39ada80c]{font-size:18px;font-weight:600;text-align:center}\n\n/* 筛选标签 */.filter-tabs[data-v-39ada80c]{display:flex;gap:12px;margin-bottom:5px;flex-wrap:wrap;padding:10px 4px}.filter-tab[data-v-39ada80c]{padding:10px 20px;border:2px solid #e2e8f0;background:#fff;color:#64748b;border-radius:25px;font-size:14px;text-align:center;white-space:nowrap;cursor:pointer;transition:all .3s ease;font-weight:500}.filter-tab.active[data-v-39ada80c]{background:linear-gradient(135deg,#4568dc,#b06ab3);border-color:transparent;color:#fff;-webkit-transform:translateY(-2px);transform:translateY(-2px);box-shadow:0 4px 12px rgba(69,104,220,.3)}.filter-tab[data-v-39ada80c]:hover:not(.active){border-color:#cbd5e1;background:#f8fafc}\n\n/* 刷新按钮 */.refresh-btn[data-v-39ada80c]{margin-left:auto;background:rgba(69,104,220,.1);border:2px solid rgba(69,104,220,.2);color:#4568dc;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;font-size:16px;flex-shrink:0}.refresh-btn[data-v-39ada80c]:hover:not(:disabled){background:rgba(69,104,220,.15);border-color:rgba(69,104,220,.3);-webkit-transform:rotate(180deg);transform:rotate(180deg)}.refresh-btn[data-v-39ada80c]:disabled{opacity:.6;cursor:not-allowed}.refresh-btn.loading[data-v-39ada80c]{-webkit-animation:spin-data-v-39ada80c 1s linear infinite;animation:spin-data-v-39ada80c 1s linear infinite}\n\n/* 作品网格 */.works-grid[data-v-39ada80c]{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:40px}.work-card[data-v-39ada80c]{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.05);transition:box-shadow .3s ease,-webkit-transform .3s ease;transition:transform .3s ease,box-shadow .3s ease;transition:transform .3s ease,box-shadow .3s ease,-webkit-transform .3s ease;cursor:pointer}.work-card[data-v-39ada80c]:hover{-webkit-transform:translateY(-8px);transform:translateY(-8px);box-shadow:0 8px 25px rgba(0,0,0,.1)}.work-thumbnail[data-v-39ada80c]{position:relative;width:100%;height:140px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;overflow:hidden}.back-btn[data-v-39ada80c]{background:hsla(0,0%,100%,.2);border:1px solid hsla(0,0%,100%,.3);color:#fff;padding:6px 12px;border-radius:6px;font-size:14px;cursor:pointer;transition:all .3s ease}.back-btn[data-v-39ada80c]:hover{background:hsla(0,0%,100%,.3)}\n\n/* 缩略图容器 */.thumbnail-image[data-v-39ada80c]{position:relative;width:100%;height:100%;overflow:hidden}.thumbnail-img[data-v-39ada80c]{width:100%;height:100%;object-fit:cover;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.work-card:hover .thumbnail-img[data-v-39ada80c]{-webkit-transform:scale(1.05);transform:scale(1.05)}\n\n/* 文件类型覆盖图标 */.file-type-overlay[data-v-39ada80c]{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,.7);border-radius:6px;padding:4px 6px}.type-icon[data-v-39ada80c]{font-size:12px;color:#fff}\n\n/* 占位符样式 */.thumbnail-placeholder[data-v-39ada80c]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:relative;color:#fff;transition:all .3s ease}.thumbnail-placeholder.waiting[data-v-39ada80c]{background:linear-gradient(135deg,#e2e8f0,#cbd5e1);color:#64748b}.thumbnail-placeholder.loading[data-v-39ada80c]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.thumbnail-placeholder.no-cover[data-v-39ada80c]{background:linear-gradient(135deg,#f1f5f9,#e2e8f0);color:#94a3b8}.media-icon[data-v-39ada80c]{font-size:36px;opacity:.6;margin-bottom:8px}\n\n/* 加载指示器 */.loading-indicator[data-v-39ada80c]{position:absolute;bottom:8px;right:8px}.loading-spinner-small[data-v-39ada80c]{width:16px;height:16px;border:2px solid #e2e8f0;border-top:2px solid #4568dc;border-radius:50%;-webkit-animation:spin-data-v-39ada80c 1s linear infinite;animation:spin-data-v-39ada80c 1s linear infinite}.work-status[data-v-39ada80c]{position:absolute;top:8px;left:8px;padding:4px 8px;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.work-status.pending[data-v-39ada80c]{background:#fef3c7;color:#d97706;border:1px solid #fcd34d}.work-status.rated[data-v-39ada80c]{background:#dbeafe;color:#2563eb;border:1px solid #93c5fd}.work-score[data-v-39ada80c]{position:absolute;top:8px;right:8px;background:rgba(0,0,0,.8);color:#fff;padding:4px 8px;border-radius:8px;font-size:10px;font-weight:600}.work-info[data-v-39ada80c]{padding:16px;background:#fff}.work-title[data-v-39ada80c]{font-size:14px;font-weight:600;color:#1e293b;margin-bottom:8px;line-height:1.4;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-clamp:2;overflow:hidden;text-overflow:ellipsis;word-break:break-word;min-height:calc(1.4em * 2)}.work-meta[data-v-39ada80c]{display:flex;align-items:center;gap:8px}.work-type[data-v-39ada80c]{font-size:10px;color:#64748b;background:#f1f5f9;padding:2px 6px;border-radius:4px;font-weight:500}.empty-state[data-v-39ada80c]{text-align:center;padding:80px 20px;color:#64748b}.empty-icon[data-v-39ada80c]{font-size:64px;margin-bottom:20px;opacity:.6;display:block}.empty-title[data-v-39ada80c]{font-size:20px;font-weight:600;margin-bottom:8px;color:#1e293b;display:block}.empty-text[data-v-39ada80c]{font-size:14px;color:#64748b;display:block;margin-bottom:20px}.empty-action[data-v-39ada80c]{margin-top:24px}.action-btn[data-v-39ada80c]{background:linear-gradient(135deg,#4568dc,#b06ab3);color:#fff;border:none;border-radius:12px;padding:12px 24px;font-size:14px;font-weight:500;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px rgba(69,104,220,.3)}.action-btn[data-v-39ada80c]:hover:not(:disabled){-webkit-transform:translateY(-2px);transform:translateY(-2px);box-shadow:0 6px 20px rgba(69,104,220,.4)}.action-btn[data-v-39ada80c]:disabled{opacity:.6;cursor:not-allowed;-webkit-transform:none;transform:none;box-shadow:none}\n\n/* 加载状态 */.loading-state[data-v-39ada80c]{text-align:center;padding:80px 20px;color:#64748b}.loading-spinner[data-v-39ada80c]{width:32px;height:32px;border:3px solid hsla(0,0%,100%,.3);border-top:3px solid #fff;border-radius:50%;-webkit-animation:spin-data-v-39ada80c 1s linear infinite;animation:spin-data-v-39ada80c 1s linear infinite;margin-bottom:12px}@-webkit-keyframes spin-data-v-39ada80c{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.placeholder-text[data-v-39ada80c]{font-size:14px;color:hsla(0,0%,100%,.9);font-weight:500}@keyframes spin-data-v-39ada80c{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}\n\n/* 响应式设计 */@media (min-width:768px){.works-container[data-v-39ada80c]{padding:24px;padding-top:0}.custom-header[data-v-39ada80c]{margin:-24px -24px 24px -24px}.filter-tabs[data-v-39ada80c]{gap:16px}}@media (max-width:480px){.filter-tab[data-v-39ada80c]{padding:8px 16px;font-size:13px}.work-thumbnail[data-v-39ada80c]{height:120px}.media-icon[data-v-39ada80c]{font-size:30px}.work-info[data-v-39ada80c]{padding:12px}.work-title[data-v-39ada80c]{font-size:13px}.work-type[data-v-39ada80c]{font-size:9px;padding:2px 4px}}\n\n/* 封面状态指示器样式 */.cover-status-indicator[data-v-39ada80c]{position:absolute;top:8px;left:8px;background:rgba(0,0,0,.7);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;z-index:2;transition:all .2s ease}.cover-status-indicator[data-v-39ada80c]:hover{background:rgba(0,0,0,.9);-webkit-transform:scale(1.1);transform:scale(1.1)}.cover-icon[data-v-39ada80c]{line-height:1;display:block}\n\n/* 不同状态的指示器颜色 */.work-thumbnail:hover .cover-status-indicator[data-v-39ada80c]{opacity:1;-webkit-transform:scale(1.05);transform:scale(1.05)}\n\n/* 添加一些额外的视觉效果 */.work-item:hover .cover-status-indicator[data-v-39ada80c]{background:rgba(16,185,129,.8);color:#fff}",""]),e.exports=t},"1e0b":function(e,t,r){var a=r("1987");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=r("967d").default;n("2acd121e",a,!0,{sourceMap:!1,shadowMode:!1})},"3c8a":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"works-container"},[r("div",{staticClass:"custom-header"},[r("div",{staticClass:"header-content"},[r("v-uni-button",{staticClass:"back-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goBack.apply(void 0,arguments)}}},[e._v("← 返回")]),r("h1",{staticClass:"header-title"},[e._v("作品列表")]),r("div",{staticClass:"header-placeholder"})],1)]),r("div",{staticClass:"filter-tabs"},[r("div",{staticClass:"filter-tab",class:{active:"all"===e.currentFilter},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.setFilter("all")}}},[e._v("全部作品 ("+e._s(e.allWorks.length)+")")]),r("div",{staticClass:"filter-tab",class:{active:"pending"===e.currentFilter},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.setFilter("pending")}}},[e._v("待评分 ("+e._s(e.pendingWorks.length)+")")]),r("div",{staticClass:"filter-tab",class:{active:"rated"===e.currentFilter},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.setFilter("rated")}}},[e._v("已评分 ("+e._s(e.ratedWorks.length)+")")]),r("v-uni-button",{staticClass:"refresh-btn",class:{loading:e.loading},attrs:{disabled:e.loading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.refreshWorks.apply(void 0,arguments)}}},[e._v("🔄")])],1),e.loading?r("div",{staticClass:"loading-state"},[r("div",{staticClass:"loading-spinner"}),r("p",[e._v("加载中...")])]):r("div",{staticClass:"works-grid"},e._l(e.filteredWorks,(function(t){return r("div",{key:t.id,staticClass:"work-card",attrs:{"data-work-id":t.id},on:{click:function(r){arguments[0]=r=e.$handleEvent(r),e.goToWorkDetail(t.id)}}},[r("div",{staticClass:"work-thumbnail"},[e.getWorkThumbnail(t)?r("div",{staticClass:"thumbnail-image"},[r("img",{staticClass:"thumbnail-img",attrs:{src:e.getWorkThumbnail(t),alt:t.title,loading:"lazy"},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.onThumbnailLoad.apply(void 0,arguments)},error:function(r){arguments[0]=r=e.$handleEvent(r),e.onCoverImageError(t,r)}}}),r("div",{staticClass:"file-type-overlay"},[r("span",{staticClass:"type-icon"},[e._v(e._s("video"===t.type?"🎥":"🖼️"))])])]):r("div",{staticClass:"thumbnail-placeholder",class:e.getCoverLoadingClass(t)},[e.isLoadingCover(t)?r("div",{staticClass:"loading-spinner"}):e._e(),e.isVisibleWork(t)?e.isLoadingCover(t)?r("span",{staticClass:"placeholder-text"},[e._v("加载封面中...")]):r("span",{staticClass:"placeholder-text"},[e._v("暂无封面")]):r("span",{staticClass:"placeholder-text"},[e._v("📷")])]),r("div",{staticClass:"work-status",class:e.isWorkRatedByUser(t)?"rated":"pending"},[e._v(e._s(e.isWorkRatedByUser(t)?"已评分":"待评分"))]),e.isWorkRatedByUser(t)?r("div",{staticClass:"work-score"},[e._v(e._s(e.getUserScore(t))+"分")]):e._e()]),r("div",{staticClass:"work-info"},[r("p",{staticClass:"work-title"},[e._v(e._s(e.filterWorkTitle(t.title)))]),r("div",{staticClass:"work-meta"},[r("span",{staticClass:"work-type"},[e._v(e._s("video"===t.type?"视频":"长图片"))])])])])})),0),e.loading||0!==e.filteredWorks.length?e._e():r("div",{staticClass:"empty-state"},[r("span",{staticClass:"empty-icon"},[e._v(e._s("pending"===e.currentFilter?"⏳":"rated"===e.currentFilter?"✅":"📋"))]),r("p",{staticClass:"empty-title"},[e._v(e._s("pending"===e.currentFilter?"暂无待评分作品":"rated"===e.currentFilter?"暂无已评分作品":0===e.allWorks.length?"暂无分配的作品":"暂无作品"))]),r("p",{staticClass:"empty-text"},[e._v(e._s("pending"===e.currentFilter?"所有分配的作品都已完成评分":"rated"===e.currentFilter?"还没有评分任何作品，快去开始评分吧":0===e.allWorks.length?"您还没有被分配任何作品，请联系管理员":"暂无符合条件的作品"))]),"pending"===e.currentFilter&&e.ratedWorks.length>0?r("div",{staticClass:"empty-action"},[r("v-uni-button",{staticClass:"action-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.setFilter("rated")}}},[e._v("查看已评分作品")])],1):"rated"===e.currentFilter&&e.pendingWorks.length>0?r("div",{staticClass:"empty-action"},[r("v-uni-button",{staticClass:"action-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.setFilter("pending")}}},[e._v("开始评分作品")])],1):0===e.allWorks.length?r("div",{staticClass:"empty-action"},[r("v-uni-button",{staticClass:"action-btn",attrs:{disabled:e.loading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.refreshWorks.apply(void 0,arguments)}}},[e._v(e._s(e.loading?"刷新中...":"刷新列表"))])],1):e._e()])])},n=[]},"3e1e":function(e,t,r){"use strict";r.r(t);var a=r("3c8a"),n=r("dfe9");for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);r("fef3");var i=r("828b"),s=Object(i["a"])(n["default"],a["b"],a["c"],!1,null,"39ada80c",null,!1,a["a"],void 0);t["default"]=s.exports},"3e37":function(e,t,r){"use strict";var a=r("8bdb"),n=r("71e9"),o=r("7992"),i=r("0a8b"),s=r("4135"),c=r("5075"),l=r("a537");a({target:"Promise",stat:!0,forced:l},{allSettled:function(e){var t=this,r=i.f(t),a=r.resolve,l=r.reject,u=s((function(){var r=o(t.resolve),i=[],s=0,l=1;c(e,(function(e){var o=s++,c=!1;l++,n(r,t,e).then((function(e){c||(c=!0,i[o]={status:"fulfilled",value:e},--l||a(i))}),(function(e){c||(c=!0,i[o]={status:"rejected",reason:e},--l||a(i))}))})),--l||a(i)}));return u.error&&l(u.value),r.promise}})},4135:function(e,t,r){"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},"53f7":function(e,t,r){"use strict";var a=r("7658"),n=r("57e7");a("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n)},"69e4":function(e,t,r){"use strict";var a=r("85c1");e.exports=a.Promise},"6b21":function(e,t,r){"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},"897c":function(e,t,r){"use strict";var a=r("6b21"),n=r("db06");e.exports=!a&&!n&&"object"==typeof window&&"object"==typeof document},a537:function(e,t,r){"use strict";var a=r("69e4"),n=r("29ba"),o=r("1052").CONSTRUCTOR;e.exports=o||!n((function(e){a.all(e).then(void 0,(function(){}))}))},dfe9:function(e,t,r){"use strict";r.r(t);var a=r("0f1f"),n=r.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},f3f7:function(e,t,r){"use strict";r("53f7")},fb2c:function(e,t,r){"use strict";var a=r("8bdb"),n=r("5075"),o=r("85f7");a({target:"Object",stat:!0},{fromEntries:function(e){var t={};return n(e,(function(e,r){o(t,e,r)}),{AS_ENTRIES:!0}),t}})},fef3:function(e,t,r){"use strict";var a=r("1e0b"),n=r.n(a);n.a}}]);